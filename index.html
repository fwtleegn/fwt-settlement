<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FWT Settlement Assistant</title>

<!--
FWT_INTERNAL_TOOL
Owner: FRIENDS WITH TENNIS
Purpose: Tennis Settlement Assistant
Distribution: Private / Internal Use Only
-->

<script src="https://unpkg.com/tesseract.js@5.0.5/dist/tesseract.min.js"></script>

<style>
:root{--bg:#f5f7f8;--card:#fff;--line:#e6e8eb;--text:#111;--muted:#666;--accent:#0f766e}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;background:var(--bg);color:var(--text)}
.wrap{max-width:920px;margin:18px auto;padding:0 14px 40px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin-bottom:14px}
h2{font-size:15px;margin:0 0 10px}
label{font-size:12px;color:var(--muted);display:block;margin:10px 0 6px}
input,textarea,select{width:100%;box-sizing:border-box;padding:10px;border-radius:10px;border:1px solid var(--line);font-size:14px}
textarea{min-height:140px}
button{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
button.secondary{background:#fff;color:#111;border:1px solid var(--line)}
button:disabled{opacity:.55;cursor:not-allowed}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.hr{height:1px;background:var(--line);margin:12px 0}
.big{font-size:18px;font-weight:800}
.mono{font-family:ui-monospace,monospace}
.muted{font-size:12px;color:var(--muted)}
.split{display:flex;justify-content:space-between;align-items:baseline;gap:10px}
.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}

/* FWT HEADER */
.fwt-header{display:flex;align-items:center;gap:14px;background:var(--accent);color:#fff;padding:14px 18px;border-radius:14px;margin-bottom:16px}
.fwt-logo{font-size:26px;font-weight:900;background:#fff;color:var(--accent);padding:6px 12px;border-radius:10px;letter-spacing:2px}
.fwt-title .name{font-size:16px;font-weight:800}
.fwt-title .sub{font-size:12px;opacity:.85}

/* FOOTER */
.fwt-footer{margin-top:20px;padding:14px;font-size:12px;color:#555;text-align:center;background:#f0fdfa;border:1px solid #c7f0ea;border-radius:12px}

/* preview */
.preview-img{max-width:100%;border-radius:12px;border:1px solid var(--line);display:none;margin-top:10px}
.progressline{margin-top:8px}
</style>
</head>

<body>
<div class="wrap">

<header class="fwt-header">
  <div class="fwt-logo">FWT</div>
  <div class="fwt-title">
    <div class="name">FRIENDS WITH TENNIS</div>
    <div class="sub">Settlement Assistant Â· Internal Use Only</div>
  </div>
</header>

<div class="card">
  <h2>ğŸ“· ì°¸ì„ì ìŠ¤í¬ë¦°ìƒ· OCR (ì—¬ëŸ¬ ì¥ í•œ ë²ˆì—)</h2>
  <div class="muted">íŒ: ëª…ë‹¨ ë¶€ë¶„ë§Œ í¬ê²Œ í™•ëŒ€í•´ì„œ 2~3ì¥ìœ¼ë¡œ ë‚˜ëˆ  ì°ìœ¼ë©´ ì •í™•ë„ ê¸‰ìƒìŠ¹</div>

  <input type="file" id="imgInput" accept="image/*" multiple>

  <div class="row" style="margin-top:10px">
    <div>
      <label>ì „ì²˜ë¦¬ ê°•ë„(ê¶Œì¥ 2)</label>
      <select id="prepLevel">
        <option value="1">1 (ì•½)</option>
        <option value="2" selected>2 (ê¶Œì¥)</option>
        <option value="3">3 (ê°•)</option>
      </select>
    </div>
    <div>
      <label>í™•ëŒ€ ë°°ìœ¨(ê¶Œì¥ 3x)</label>
      <select id="scale">
        <option value="2">2x</option>
        <option value="3" selected>3x</option>
        <option value="4">4x</option>
      </select>
    </div>
  </div>

  <div class="btns">
    <button id="btnOCR">OCR ì‹¤í–‰(ì„ íƒí•œ ì´ë¯¸ì§€ ì „ë¶€)</button>
    <button class="secondary" id="btnClear">ì´ˆê¸°í™”</button>
  </div>

  <img id="previewImg" class="preview-img" alt="preview">
  <div class="progressline mono muted" id="batchStatus">-</div>
  <div class="hr"></div>
  <div class="mono muted" id="ocrStatus">ëŒ€ê¸°ì¤‘</div>
</div>

<div class="card">
  <h2>ğŸ‘¥ ì°¸ì„ì ëª…ë‹¨</h2>
  <div class="muted">#ìœ¼ë¡œ ì‹œì‘í•˜ë©´ ì •ì‚° ì œì™¸ (ì˜ˆ: #ìš´ì˜ì§„)</div>
  <textarea id="names" placeholder="@Olive&#10;@ëƒ¥ì´&#10;ë¸Œë¼ë”&#10;#ìš´ì˜ì§„"></textarea>
  <div class="hr"></div>
  <div class="split">
    <div class="muted">ì •ì‚° ëŒ€ìƒ</div><div class="big mono" id="count">0ëª…</div>
  </div>
</div>

<div class="card">
  <h2>ğŸ—“ï¸ ì •ì‚° ì •ë³´</h2>

  <div class="row">
    <div>
      <label>ë‚ ì§œ ì„ íƒ</label>
      <input id="datePick" type="date">
      <div class="muted mono" id="datePreview">-</div>
    </div>
    <div>
      <label>ê³„ì¢Œë²ˆí˜¸(ì…ë ¥ ê·¸ëŒ€ë¡œ ì¶œë ¥)</label>
      <input id="accountLine" type="text" placeholder="ì˜ˆ: ì¹´ì¹´ì˜¤ë±…í¬ 3333-12-3456789 (ì¡°ì„±ì‚°)">
    </div>
  </div>
</div>

<div class="card">
  <h2>ğŸ’° ë¹„ìš© ì…ë ¥</h2>

  <label>ì½”íŠ¸ë¹„</label>
  <div class="row3">
    <input id="courts" placeholder="ì½”íŠ¸ ìˆ˜ (ì˜ˆ: 2)" inputmode="numeric">
    <input id="hourly" placeholder="ì‹œê°„ë‹¹ ë¹„ìš© (ì˜ˆ: 50000)" inputmode="numeric">
    <input id="hours" placeholder="ì‚¬ìš© ì‹œê°„ (ì˜ˆ: 2)" inputmode="decimal">
  </div>

  <label>ìº”ë³¼</label>
  <div class="row">
    <input id="ballsQty" placeholder="ìº”ë³¼ ìˆ˜ëŸ‰ (ì˜ˆ: 3)" inputmode="numeric">
    <input id="ballsPrice" placeholder="ìº”ë³¼ ê°€ê²© (ì˜ˆ: 10000)" inputmode="numeric">
  </div>

  <div class="hr"></div>

  <div class="split">
    <div class="muted">ì´ ì½”íŠ¸ë¹„</div><div class="big mono" id="courtTotal">0ì›</div>
  </div>
  <div class="split">
    <div class="muted">ì´ ìº”ë³¼ë¹„</div><div class="big mono" id="ballTotal">0ì›</div>
  </div>
  <div class="split">
    <div class="muted">ì´ì•¡</div><div class="big mono" id="grandTotal">0ì›</div>
  </div>
  <div class="split">
    <div class="muted">1/N</div><div class="big mono" id="per">0ì›</div>
  </div>
  <div class="muted mono" id="formula">-</div>
</div>

<div class="card">
  <h2>ğŸ“‹ ë³µì‚¬ìš© ê²°ê³¼</h2>
  <textarea id="output" class="mono" readonly></textarea>
  <button style="margin-top:8px" id="copyBtn">ë³µì‚¬</button>
  <div class="muted" style="margin-top:8px">
    ì¶œë ¥ì€ â€œìš”ì•½ â†’ ëª…ë‹¨ â†’ (ë¹ˆì¤„) 1/N â†’ (ë¹ˆì¤„) ê³„ì¢Œâ€ ìˆœì„œë¡œ ìƒì„±ë©ë‹ˆë‹¤.
  </div>
</div>

<footer class="fwt-footer">
Â© FRIENDS WITH TENNIS (FWT)<br>
ë³¸ ì›¹ì•±ì€ FWT ë‚´ë¶€ ì •ì‚° ë³´ì¡°ìš©ìœ¼ë¡œë§Œ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
ë¬´ë‹¨ ë³µì œÂ·ë°°í¬Â·ìˆ˜ì • ë° íƒ€ í´ëŸ½ ì‚¬ìš©ì„ ê¸ˆí•©ë‹ˆë‹¤.
</footer>

</div>

<script>
const __FWT_SIGNATURE__ = "FRIENDS_WITH_TENNIS_INTERNAL_ONLY_2026";

const $ = (id) => document.getElementById(id);
const fmt = (n) => Math.round(n).toLocaleString() + "ì›";
const num = (v) => Number(String(v||"").replace(/[,\sì›]/g,"")) || 0;

let isRunning = false;

const KOR_WEEK = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];

function pad2(n){ return String(n).padStart(2,"0"); }

function formatKDate(dateStr){
  // dateStr: YYYY-MM-DD
  if(!dateStr) return "";
  const d = new Date(dateStr + "T00:00:00");
  if(Number.isNaN(d.getTime())) return "";
  const mm = pad2(d.getMonth()+1);
  const dd = pad2(d.getDate());
  const wd = KOR_WEEK[d.getDay()];
  return `${mm}ì›”${dd}ì¼(${wd})`;
}

function getIncludedNames(){
  return $("names").value
    .split("\n")
    .map(v => v.trim())
    .filter(v => v && !v.startsWith("#"));
}

function recalc(){
  const courts = num($("courts").value);
  const hourly = num($("hourly").value);
  const hours  = num($("hours").value);
  const ballsQ = num($("ballsQty").value);
  const ballsP = num($("ballsPrice").value);

  const courtTotal = courts * hourly * hours;
  const ballTotal  = ballsQ * ballsP;
  const grandTotal = courtTotal + ballTotal;

  $("courtTotal").textContent = fmt(courtTotal);
  $("ballTotal").textContent  = fmt(ballTotal);
  $("grandTotal").textContent = fmt(grandTotal);

  const list = getIncludedNames();
  $("count").textContent = list.length + "ëª…";

  const perVal = list.length ? (grandTotal / list.length) : 0;
  $("per").textContent = list.length ? fmt(perVal) : "0ì›";

  $("formula").textContent =
    `${courts}ì½”íŠ¸ Ã— ${hourly.toLocaleString()}ì›/ì‹œê°„ Ã— ${hours}ì‹œê°„ + ` +
    `${ballsQ}ê°œ Ã— ${ballsP.toLocaleString()}ì›`;

  const dateStr = $("datePick").value;
  const dateLabel = formatKDate(dateStr);
  $("datePreview").textContent = dateLabel ? `${dateLabel}` : "-";

  const headerLine = dateLabel ? `${dateLabel} ì½”íŠ¸ë¹„ ì •ì‚°ì…ë‹ˆë‹¤.` : `ì½”íŠ¸ë¹„ ì •ì‚°ì…ë‹ˆë‹¤.`;

  const nameLines = list.map(n => n.startsWith("@") ? n : "@"+n);

  const account = ($("accountLine").value || "").trim();

  // âœ… ìš”êµ¬ì‚¬í•­: ìš”ì•½ ë¸”ë¡ì€ ìœ ì§€, 1/Nì€ ë§¨ ì•„ë˜(ëª…ë‹¨ ë)ë¡œ ì´ë™
  // ì¶œë ¥: í—¤ë” â†’ ìš”ì•½(1/N ì œì™¸) â†’ ë¹ˆì¤„ â†’ ëª…ë‹¨ â†’ ë¹ˆì¤„ â†’ 1/N â†’ ë¹ˆì¤„ â†’ ê³„ì¢Œ(ì…ë ¥ ê·¸ëŒ€ë¡œ)
  const lines = [
    headerLine,
    "",
    "ì´ ì½”íŠ¸ë¹„: " + fmt(courtTot
