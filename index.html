<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FWT Settlement Assistant</title>

<script src="https://unpkg.com/tesseract.js@5.0.5/dist/tesseract.min.js"></script>

<style>
:root{--bg:#f5f7f8;--card:#fff;--line:#e6e8eb;--text:#111;--muted:#666;--accent:#0f766e}
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;background:var(--bg);color:var(--text)}
.wrap{max-width:920px;margin:18px auto;padding:0 14px 40px}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin-bottom:14px}
h2{font-size:15px;margin:0 0 10px}
label{font-size:12px;color:var(--muted)}
input,textarea,select{width:100%;box-sizing:border-box;padding:10px;border-radius:10px;border:1px solid var(--line);font-size:14px}
textarea{min-height:140px}
button{background:var(--accent);color:#fff;border:none;border-radius:10px;padding:10px 14px;cursor:pointer}
button.secondary{background:#fff;color:#111;border:1px solid var(--line)}
button:disabled{opacity:.5}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.hr{height:1px;background:var(--line);margin:12px 0}
.big{font-size:18px;font-weight:800}
.mono{font-family:ui-monospace,monospace}
.muted{font-size:12px;color:var(--muted)}
.split{display:flex;justify-content:space-between}
.btns{display:flex;gap:10px;margin-top:10px}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
<h2>ğŸ“· ì°¸ì„ì ìŠ¤í¬ë¦°ìƒ· OCR (ì•ˆì • ë²„ì „)</h2>
<input type="file" id="imgInput" accept="image/*" multiple>
<div class="btns">
<button id="btnOCR">OCR ì‹¤í–‰</button>
<button class="secondary" id="btnClear">ì´ˆê¸°í™”</button>
</div>
<div class="hr"></div>
<div class="mono muted" id="ocrStatus">ëŒ€ê¸°ì¤‘</div>
</div>

<div class="card">
<h2>ğŸ‘¥ ì°¸ì„ì ëª…ë‹¨</h2>
<textarea id="names"></textarea>
<div class="hr"></div>
<div class="split">
<div class="muted">ì •ì‚° ëŒ€ìƒ</div><div class="big mono" id="count">0ëª…</div>
</div>
</div>

<div class="card">
<h2>ğŸ—“ï¸ ì •ì‚° ì •ë³´</h2>
<div class="row">
<input type="date" id="datePick">
<input type="text" id="accountLine" placeholder="ê³„ì¢Œë²ˆí˜¸ (ê·¸ëŒ€ë¡œ ì¶œë ¥)">
</div>
</div>

<div class="card">
<h2>ğŸ’° ë¹„ìš© ì…ë ¥</h2>
<div class="row3">
<input id="courts" placeholder="ì½”íŠ¸ ìˆ˜">
<input id="hourly" placeholder="ì‹œê°„ë‹¹ ë¹„ìš©">
<input id="hours" placeholder="ì‹œê°„">
</div>
<div class="row" style="margin-top:8px">
<input id="ballsQty" placeholder="ìº”ë³¼ ìˆ˜ëŸ‰">
<input id="ballsPrice" placeholder="ìº”ë³¼ ê°€ê²©">
</div>
<div class="hr"></div>
<div class="split"><div>ì´ ì½”íŠ¸ë¹„</div><div class="mono" id="courtTotal">0ì›</div></div>
<div class="split"><div>ì´ ìº”ë³¼ë¹„</div><div class="mono" id="ballTotal">0ì›</div></div>
<div class="split"><div>ì´ì•¡</div><div class="mono" id="grandTotal">0ì›</div></div>
</div>

<div class="card">
<h2>ğŸ“‹ ë³µì‚¬ìš© ê²°ê³¼</h2>
<textarea id="output" class="mono" readonly></textarea>
<button id="copyBtn" style="margin-top:8px">ë³µì‚¬</button>
</div>

</div>

<script>
const $=id=>document.getElementById(id);
const num=v=>Number(String(v||"").replace(/[^\d.]/g,""))||0;
const fmt=n=>Math.round(n).toLocaleString()+"ì›";
const W=["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];

function fmtDate(v){
 if(!v) return "";
 const d=new Date(v+"T00:00:00");
 return `${String(d.getMonth()+1).padStart(2,"0")}ì›”${String(d.getDate()).padStart(2,"0")}ì¼(${W[d.getDay()]})`;
}

async function runOCR(){
 const files=[...imgInput.files];
 if(!files.length){ocrStatus.textContent="ì´ë¯¸ì§€ ì„ íƒ í•„ìš”";return;}
 ocrStatus.textContent="OCR ì‹œì‘â€¦";
 for(const f of files){
   ocrStatus.textContent=`ì²˜ë¦¬ì¤‘: ${f.name}`;
   const worker=await Tesseract.createWorker("kor+eng");
   const {data}=await worker.recognize(f);
   await worker.terminate();
   const lines=data.text.split("\n").map(v=>v.trim()).filter(v=>v.length>1);
   if(lines.length){
     names.value+=(names.value?"\n":"")+lines.join("\n");
   }
 }
 ocrStatus.textContent="OCR ì™„ë£Œ (ê²€í†  ê¶Œì¥)";
 recalc();
}

function recalc(){
 const list=names.value.split("\n").map(v=>v.trim()).filter(v=>v&&!v.startsWith("#"));
 count.textContent=list.length+"ëª…";
 const court=num(courts.value)*num(hourly.value)*num(hours.value);
 const ball=num(ballsQty.value)*num(ballsPrice.value);
 const total=court+ball;
 courtTotal.textContent=fmt(court);
 ballTotal.textContent=fmt(ball);
 grandTotal.textContent=fmt(total);
 const per=list.length?fmt(total/list.length):"0ì›";

 const header=fmtDate(datePick.value)+" ì½”íŠ¸ë¹„ ì •ì‚°ì…ë‹ˆë‹¤.";
 output.value=[
   header,"",
   "ì´ ì½”íŠ¸ë¹„: "+fmt(court),
   "ì´ ìº”ë³¼ë¹„: "+fmt(ball),
   "ì´ì•¡: "+fmt(total),
   "ì •ì‚°ëŒ€ìƒ: "+list.length+"ëª…","",
   ...list.map(n=>n.startsWith("@")?n:"@"+n),
   "", "1/N: "+per,
   accountLine.value?("\n"+accountLine.value):""
 ].join("\n");
}

btnOCR.onclick=runOCR;
btnClear.onclick=()=>{names.value="";output.value="";ocrStatus.textContent="ëŒ€ê¸°ì¤‘";recalc();}
copyBtn.onclick=()=>navigator.clipboard.writeText(output.value);

["names","courts","hourly","hours","ballsQty","ballsPrice","datePick","accountLine"]
.forEach(id=>$(id).addEventListener("input",recalc));

datePick.value=new Date().toISOString().slice(0,10);
recalc();
</script>
</body>
</html>